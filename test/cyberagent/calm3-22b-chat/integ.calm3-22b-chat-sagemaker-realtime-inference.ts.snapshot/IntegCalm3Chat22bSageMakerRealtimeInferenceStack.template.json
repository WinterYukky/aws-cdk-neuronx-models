{
 "Resources": {
  "Vpc8378EB38": {
   "Type": "AWS::EC2::VPC",
   "Properties": {
    "CidrBlock": "10.0.0.0/16",
    "EnableDnsHostnames": true,
    "EnableDnsSupport": true,
    "InstanceTenancy": "default",
    "Tags": [
     {
      "Key": "Name",
      "Value": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/Vpc"
     }
    ]
   }
  },
  "VpcPublicSubnet1Subnet5C2D37C4": {
   "Type": "AWS::EC2::Subnet",
   "Properties": {
    "AvailabilityZone": {
     "Fn::Select": [
      0,
      {
       "Fn::GetAZs": ""
      }
     ]
    },
    "CidrBlock": "10.0.0.0/18",
    "MapPublicIpOnLaunch": true,
    "Tags": [
     {
      "Key": "aws-cdk:subnet-name",
      "Value": "Public"
     },
     {
      "Key": "aws-cdk:subnet-type",
      "Value": "Public"
     },
     {
      "Key": "Name",
      "Value": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/Vpc/PublicSubnet1"
     }
    ],
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "VpcPublicSubnet1RouteTable6C95E38E": {
   "Type": "AWS::EC2::RouteTable",
   "Properties": {
    "Tags": [
     {
      "Key": "Name",
      "Value": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/Vpc/PublicSubnet1"
     }
    ],
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "VpcPublicSubnet1RouteTableAssociation97140677": {
   "Type": "AWS::EC2::SubnetRouteTableAssociation",
   "Properties": {
    "RouteTableId": {
     "Ref": "VpcPublicSubnet1RouteTable6C95E38E"
    },
    "SubnetId": {
     "Ref": "VpcPublicSubnet1Subnet5C2D37C4"
    }
   }
  },
  "VpcPublicSubnet1DefaultRoute3DA9E72A": {
   "Type": "AWS::EC2::Route",
   "Properties": {
    "DestinationCidrBlock": "0.0.0.0/0",
    "GatewayId": {
     "Ref": "VpcIGWD7BA715C"
    },
    "RouteTableId": {
     "Ref": "VpcPublicSubnet1RouteTable6C95E38E"
    }
   },
   "DependsOn": [
    "VpcVPCGWBF912B6E"
   ]
  },
  "VpcPublicSubnet1EIPD7E02669": {
   "Type": "AWS::EC2::EIP",
   "Properties": {
    "Domain": "vpc",
    "Tags": [
     {
      "Key": "Name",
      "Value": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/Vpc/PublicSubnet1"
     }
    ]
   }
  },
  "VpcPublicSubnet1NATGateway4D7517AA": {
   "Type": "AWS::EC2::NatGateway",
   "Properties": {
    "AllocationId": {
     "Fn::GetAtt": [
      "VpcPublicSubnet1EIPD7E02669",
      "AllocationId"
     ]
    },
    "SubnetId": {
     "Ref": "VpcPublicSubnet1Subnet5C2D37C4"
    },
    "Tags": [
     {
      "Key": "Name",
      "Value": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/Vpc/PublicSubnet1"
     }
    ]
   },
   "DependsOn": [
    "VpcPublicSubnet1DefaultRoute3DA9E72A",
    "VpcPublicSubnet1RouteTableAssociation97140677"
   ]
  },
  "VpcPublicSubnet2Subnet691E08A3": {
   "Type": "AWS::EC2::Subnet",
   "Properties": {
    "AvailabilityZone": {
     "Fn::Select": [
      1,
      {
       "Fn::GetAZs": ""
      }
     ]
    },
    "CidrBlock": "10.0.64.0/18",
    "MapPublicIpOnLaunch": true,
    "Tags": [
     {
      "Key": "aws-cdk:subnet-name",
      "Value": "Public"
     },
     {
      "Key": "aws-cdk:subnet-type",
      "Value": "Public"
     },
     {
      "Key": "Name",
      "Value": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/Vpc/PublicSubnet2"
     }
    ],
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "VpcPublicSubnet2RouteTable94F7E489": {
   "Type": "AWS::EC2::RouteTable",
   "Properties": {
    "Tags": [
     {
      "Key": "Name",
      "Value": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/Vpc/PublicSubnet2"
     }
    ],
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "VpcPublicSubnet2RouteTableAssociationDD5762D8": {
   "Type": "AWS::EC2::SubnetRouteTableAssociation",
   "Properties": {
    "RouteTableId": {
     "Ref": "VpcPublicSubnet2RouteTable94F7E489"
    },
    "SubnetId": {
     "Ref": "VpcPublicSubnet2Subnet691E08A3"
    }
   }
  },
  "VpcPublicSubnet2DefaultRoute97F91067": {
   "Type": "AWS::EC2::Route",
   "Properties": {
    "DestinationCidrBlock": "0.0.0.0/0",
    "GatewayId": {
     "Ref": "VpcIGWD7BA715C"
    },
    "RouteTableId": {
     "Ref": "VpcPublicSubnet2RouteTable94F7E489"
    }
   },
   "DependsOn": [
    "VpcVPCGWBF912B6E"
   ]
  },
  "VpcPrivateSubnet1Subnet536B997A": {
   "Type": "AWS::EC2::Subnet",
   "Properties": {
    "AvailabilityZone": {
     "Fn::Select": [
      0,
      {
       "Fn::GetAZs": ""
      }
     ]
    },
    "CidrBlock": "10.0.128.0/18",
    "MapPublicIpOnLaunch": false,
    "Tags": [
     {
      "Key": "aws-cdk:subnet-name",
      "Value": "Private"
     },
     {
      "Key": "aws-cdk:subnet-type",
      "Value": "Private"
     },
     {
      "Key": "Name",
      "Value": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/Vpc/PrivateSubnet1"
     }
    ],
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "VpcPrivateSubnet1RouteTableB2C5B500": {
   "Type": "AWS::EC2::RouteTable",
   "Properties": {
    "Tags": [
     {
      "Key": "Name",
      "Value": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/Vpc/PrivateSubnet1"
     }
    ],
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "VpcPrivateSubnet1RouteTableAssociation70C59FA6": {
   "Type": "AWS::EC2::SubnetRouteTableAssociation",
   "Properties": {
    "RouteTableId": {
     "Ref": "VpcPrivateSubnet1RouteTableB2C5B500"
    },
    "SubnetId": {
     "Ref": "VpcPrivateSubnet1Subnet536B997A"
    }
   }
  },
  "VpcPrivateSubnet1DefaultRouteBE02A9ED": {
   "Type": "AWS::EC2::Route",
   "Properties": {
    "DestinationCidrBlock": "0.0.0.0/0",
    "NatGatewayId": {
     "Ref": "VpcPublicSubnet1NATGateway4D7517AA"
    },
    "RouteTableId": {
     "Ref": "VpcPrivateSubnet1RouteTableB2C5B500"
    }
   }
  },
  "VpcPrivateSubnet2Subnet3788AAA1": {
   "Type": "AWS::EC2::Subnet",
   "Properties": {
    "AvailabilityZone": {
     "Fn::Select": [
      1,
      {
       "Fn::GetAZs": ""
      }
     ]
    },
    "CidrBlock": "10.0.192.0/18",
    "MapPublicIpOnLaunch": false,
    "Tags": [
     {
      "Key": "aws-cdk:subnet-name",
      "Value": "Private"
     },
     {
      "Key": "aws-cdk:subnet-type",
      "Value": "Private"
     },
     {
      "Key": "Name",
      "Value": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/Vpc/PrivateSubnet2"
     }
    ],
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "VpcPrivateSubnet2RouteTableA678073B": {
   "Type": "AWS::EC2::RouteTable",
   "Properties": {
    "Tags": [
     {
      "Key": "Name",
      "Value": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/Vpc/PrivateSubnet2"
     }
    ],
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "VpcPrivateSubnet2RouteTableAssociationA89CAD56": {
   "Type": "AWS::EC2::SubnetRouteTableAssociation",
   "Properties": {
    "RouteTableId": {
     "Ref": "VpcPrivateSubnet2RouteTableA678073B"
    },
    "SubnetId": {
     "Ref": "VpcPrivateSubnet2Subnet3788AAA1"
    }
   }
  },
  "VpcPrivateSubnet2DefaultRoute060D2087": {
   "Type": "AWS::EC2::Route",
   "Properties": {
    "DestinationCidrBlock": "0.0.0.0/0",
    "NatGatewayId": {
     "Ref": "VpcPublicSubnet1NATGateway4D7517AA"
    },
    "RouteTableId": {
     "Ref": "VpcPrivateSubnet2RouteTableA678073B"
    }
   }
  },
  "VpcIGWD7BA715C": {
   "Type": "AWS::EC2::InternetGateway",
   "Properties": {
    "Tags": [
     {
      "Key": "Name",
      "Value": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/Vpc"
     }
    ]
   }
  },
  "VpcVPCGWBF912B6E": {
   "Type": "AWS::EC2::VPCGatewayAttachment",
   "Properties": {
    "InternetGatewayId": {
     "Ref": "VpcIGWD7BA715C"
    },
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "VpcRestrictDefaultSecurityGroupCustomResourceC73DA2BE": {
   "Type": "Custom::VpcRestrictDefaultSG",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "CustomVpcRestrictDefaultSGCustomResourceProviderHandlerDC833E5E",
      "Arn"
     ]
    },
    "DefaultSecurityGroupId": {
     "Fn::GetAtt": [
      "Vpc8378EB38",
      "DefaultSecurityGroup"
     ]
    },
    "Account": {
     "Ref": "AWS::AccountId"
    }
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "CustomVpcRestrictDefaultSGCustomResourceProviderRole26592FE0": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Version": "2012-10-17",
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ]
    },
    "ManagedPolicyArns": [
     {
      "Fn::Sub": "arn:${AWS::Partition}:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
     }
    ],
    "Policies": [
     {
      "PolicyName": "Inline",
      "PolicyDocument": {
       "Version": "2012-10-17",
       "Statement": [
        {
         "Effect": "Allow",
         "Action": [
          "ec2:AuthorizeSecurityGroupIngress",
          "ec2:AuthorizeSecurityGroupEgress",
          "ec2:RevokeSecurityGroupIngress",
          "ec2:RevokeSecurityGroupEgress"
         ],
         "Resource": [
          {
           "Fn::Join": [
            "",
            [
             "arn:",
             {
              "Ref": "AWS::Partition"
             },
             ":ec2:",
             {
              "Ref": "AWS::Region"
             },
             ":",
             {
              "Ref": "AWS::AccountId"
             },
             ":security-group/",
             {
              "Fn::GetAtt": [
               "Vpc8378EB38",
               "DefaultSecurityGroup"
              ]
             }
            ]
           ]
          }
         ]
        }
       ]
      }
     }
    ]
   }
  },
  "CustomVpcRestrictDefaultSGCustomResourceProviderHandlerDC833E5E": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "ee7de53d64cc9d6248fa6aa550f92358f6c907b5efd6f3298aeab1b5e7ea358a.zip"
    },
    "Timeout": 900,
    "MemorySize": 128,
    "Handler": "__entrypoint__.handler",
    "Role": {
     "Fn::GetAtt": [
      "CustomVpcRestrictDefaultSGCustomResourceProviderRole26592FE0",
      "Arn"
     ]
    },
    "Runtime": {
     "Fn::FindInMap": [
      "LatestNodeRuntimeMap",
      {
       "Ref": "AWS::Region"
      },
      "value"
     ]
    },
    "Description": "Lambda function for removing all inbound/outbound rules from the VPC default security group"
   },
   "DependsOn": [
    "CustomVpcRestrictDefaultSGCustomResourceProviderRole26592FE0"
   ]
  },
  "Bucket83908E77": {
   "Type": "AWS::S3::Bucket",
   "Properties": {
    "Tags": [
     {
      "Key": "aws-cdk:auto-delete-objects",
      "Value": "true"
     },
     {
      "Key": "aws-cdk:cr-owned:cyberagent/calm3-22b-chat/neuronx-2.19.1/tp2-np1024-opt3-quants8/code:adb9f5a8",
      "Value": "true"
     },
     {
      "Key": "aws-cdk:cr-owned:cyberagent/calm3-22b-chat/neuronx-2.19.1/tp4-np4096-opt3/code:b2a9c26b",
      "Value": "true"
     }
    ]
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "BucketPolicyE9A3008A": {
   "Type": "AWS::S3::BucketPolicy",
   "Properties": {
    "Bucket": {
     "Ref": "Bucket83908E77"
    },
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "s3:DeleteObject*",
        "s3:GetBucket*",
        "s3:List*",
        "s3:PutBucketPolicy"
       ],
       "Effect": "Allow",
       "Principal": {
        "AWS": {
         "Fn::GetAtt": [
          "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092",
          "Arn"
         ]
        }
       },
       "Resource": [
        {
         "Fn::GetAtt": [
          "Bucket83908E77",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "Bucket83908E77",
             "Arn"
            ]
           },
           "/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "BucketAutoDeleteObjectsCustomResourceBAFD23C2": {
   "Type": "Custom::S3AutoDeleteObjects",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "CustomS3AutoDeleteObjectsCustomResourceProviderHandler9D90184F",
      "Arn"
     ]
    },
    "BucketName": {
     "Ref": "Bucket83908E77"
    }
   },
   "DependsOn": [
    "BucketPolicyE9A3008A"
   ],
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Version": "2012-10-17",
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ]
    },
    "ManagedPolicyArns": [
     {
      "Fn::Sub": "arn:${AWS::Partition}:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
     }
    ]
   }
  },
  "CustomS3AutoDeleteObjectsCustomResourceProviderHandler9D90184F": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "faa95a81ae7d7373f3e1f242268f904eb748d8d0fdd306e8a6fe515a1905a7d6.zip"
    },
    "Timeout": 900,
    "MemorySize": 128,
    "Handler": "index.handler",
    "Role": {
     "Fn::GetAtt": [
      "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092",
      "Arn"
     ]
    },
    "Runtime": {
     "Fn::FindInMap": [
      "LatestNodeRuntimeMap",
      {
       "Ref": "AWS::Region"
      },
      "value"
     ]
    },
    "Description": {
     "Fn::Join": [
      "",
      [
       "Lambda function for auto-deleting objects in ",
       {
        "Ref": "Bucket83908E77"
       },
       " S3 bucket."
      ]
     ]
    }
   },
   "DependsOn": [
    "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092"
   ]
  },
  "LowCostNeuronxCompileLaunchTemplate18280961": {
   "Type": "AWS::EC2::LaunchTemplate",
   "Properties": {
    "LaunchTemplateData": {
     "BlockDeviceMappings": [
      {
       "DeviceName": "/dev/xvda",
       "Ebs": {
        "VolumeSize": 110
       }
      }
     ],
     "TagSpecifications": [
      {
       "ResourceType": "instance",
       "Tags": [
        {
         "Key": "Name",
         "Value": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/LowCost/NeuronxCompile/LaunchTemplate"
        }
       ]
      },
      {
       "ResourceType": "volume",
       "Tags": [
        {
         "Key": "Name",
         "Value": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/LowCost/NeuronxCompile/LaunchTemplate"
        }
       ]
      }
     ]
    },
    "TagSpecifications": [
     {
      "ResourceType": "launch-template",
      "Tags": [
       {
        "Key": "Name",
        "Value": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/LowCost/NeuronxCompile/LaunchTemplate"
       }
      ]
     }
    ]
   }
  },
  "LowCostNeuronxCompileMachinImageNeuronxAmiProviderframeworkonEventServiceRoleF7D9ED8F": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "LowCostNeuronxCompileMachinImageNeuronxAmiProviderframeworkonEventServiceRoleDefaultPolicy85FA09A1": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "SingletonLambda08c9850a6f134ed49e2d7888d7b5a25822148CF9",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "SingletonLambda08c9850a6f134ed49e2d7888d7b5a25822148CF9",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "LowCostNeuronxCompileMachinImageNeuronxAmiProviderframeworkonEventServiceRoleDefaultPolicy85FA09A1",
    "Roles": [
     {
      "Ref": "LowCostNeuronxCompileMachinImageNeuronxAmiProviderframeworkonEventServiceRoleF7D9ED8F"
     }
    ]
   }
  },
  "LowCostNeuronxCompileMachinImageNeuronxAmiProviderframeworkonEventBED44C87": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "d9861ea7a45affd23e47a614acb2fddc6e45c20a891284c958187dafbf9ee36b.zip"
    },
    "Description": "AWS CDK resource provider framework - onEvent (IntegCalm3Chat22bSageMakerRealtimeInferenceStack/LowCost/NeuronxCompile/MachinImage/NeuronxAmiProvider)",
    "Environment": {
     "Variables": {
      "USER_ON_EVENT_FUNCTION_ARN": {
       "Fn::GetAtt": [
        "SingletonLambda08c9850a6f134ed49e2d7888d7b5a25822148CF9",
        "Arn"
       ]
      }
     }
    },
    "Handler": "framework.onEvent",
    "Role": {
     "Fn::GetAtt": [
      "LowCostNeuronxCompileMachinImageNeuronxAmiProviderframeworkonEventServiceRoleF7D9ED8F",
      "Arn"
     ]
    },
    "Runtime": {
     "Fn::FindInMap": [
      "LatestNodeRuntimeMap",
      {
       "Ref": "AWS::Region"
      },
      "value"
     ]
    },
    "Timeout": 900
   },
   "DependsOn": [
    "LowCostNeuronxCompileMachinImageNeuronxAmiProviderframeworkonEventServiceRoleDefaultPolicy85FA09A1",
    "LowCostNeuronxCompileMachinImageNeuronxAmiProviderframeworkonEventServiceRoleF7D9ED8F"
   ]
  },
  "LowCostNeuronxCompileMachinImageNeuronxAmiA4895989": {
   "Type": "Custom::NeuronxAmi",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "LowCostNeuronxCompileMachinImageNeuronxAmiProviderframeworkonEventBED44C87",
      "Arn"
     ]
    },
    "image": {
     "Ref": "LowCostNeuronxCompileMachinImageImageParameter337DF9DB"
    }
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "LowCostNeuronxCompileComputeEnvironmentSecurityGroup545D8E84": {
   "Type": "AWS::EC2::SecurityGroup",
   "Properties": {
    "GroupDescription": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/LowCost/NeuronxCompile/ComputeEnvironment/SecurityGroup",
    "SecurityGroupEgress": [
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow all outbound traffic by default",
      "IpProtocol": "-1"
     }
    ],
    "Tags": [
     {
      "Key": "Name",
      "Value": "neuronx-compile-worker"
     }
    ],
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "LowCostNeuronxCompileComputeEnvironmentInstanceProfileRole54CBAE79": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ec2.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AmazonEC2ContainerServiceforEC2Role"
       ]
      ]
     }
    ],
    "Tags": [
     {
      "Key": "Name",
      "Value": "neuronx-compile-worker"
     }
    ]
   }
  },
  "LowCostNeuronxCompileComputeEnvironmentInstanceProfileRoleDefaultPolicy9B673626": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "s3:Abort*",
        "s3:DeleteObject*",
        "s3:GetBucket*",
        "s3:GetObject*",
        "s3:List*",
        "s3:PutObject",
        "s3:PutObjectLegalHold",
        "s3:PutObjectRetention",
        "s3:PutObjectTagging",
        "s3:PutObjectVersionTagging"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "Bucket83908E77",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "Bucket83908E77",
             "Arn"
            ]
           },
           "/cyberagent/calm3-22b-chat/neuronx-2.19.1/tp2-np1024-opt3-quants8/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "LowCostNeuronxCompileComputeEnvironmentInstanceProfileRoleDefaultPolicy9B673626",
    "Roles": [
     {
      "Ref": "LowCostNeuronxCompileComputeEnvironmentInstanceProfileRole54CBAE79"
     }
    ]
   }
  },
  "LowCostNeuronxCompileComputeEnvironmentInstanceProfile28246206": {
   "Type": "AWS::IAM::InstanceProfile",
   "Properties": {
    "Roles": [
     {
      "Ref": "LowCostNeuronxCompileComputeEnvironmentInstanceProfileRole54CBAE79"
     }
    ]
   }
  },
  "LowCostNeuronxCompileComputeEnvironment98C47BC9": {
   "Type": "AWS::Batch::ComputeEnvironment",
   "Properties": {
    "ComputeResources": {
     "AllocationStrategy": "BEST_FIT_PROGRESSIVE",
     "Ec2Configuration": [
      {
       "ImageIdOverride": {
        "Fn::GetAtt": [
         "LowCostNeuronxCompileMachinImageNeuronxAmiA4895989",
         "image_id"
        ]
       },
       "ImageType": "ECS_AL2023"
      }
     ],
     "InstanceRole": {
      "Fn::GetAtt": [
       "LowCostNeuronxCompileComputeEnvironmentInstanceProfile28246206",
       "Arn"
      ]
     },
     "InstanceTypes": [
      "inf2.8xlarge"
     ],
     "LaunchTemplate": {
      "LaunchTemplateId": {
       "Ref": "LowCostNeuronxCompileLaunchTemplate18280961"
      },
      "Version": {
       "Fn::GetAtt": [
        "LowCostNeuronxCompileLaunchTemplate18280961",
        "LatestVersionNumber"
       ]
      }
     },
     "MaxvCpus": 256,
     "MinvCpus": 0,
     "SecurityGroupIds": [
      {
       "Fn::GetAtt": [
        "LowCostNeuronxCompileComputeEnvironmentSecurityGroup545D8E84",
        "GroupId"
       ]
      }
     ],
     "Subnets": [
      {
       "Ref": "VpcPrivateSubnet1Subnet536B997A"
      },
      {
       "Ref": "VpcPrivateSubnet2Subnet3788AAA1"
      }
     ],
     "Tags": {
      "Name": "neuronx-compile-worker"
     },
     "Type": "EC2"
    },
    "ReplaceComputeEnvironment": false,
    "State": "ENABLED",
    "Tags": {
     "Name": "neuronx-compile-worker"
    },
    "Type": "managed",
    "UpdatePolicy": {}
   }
  },
  "LowCostNeuronxCompileJobQueue34F1C1A1": {
   "Type": "AWS::Batch::JobQueue",
   "Properties": {
    "ComputeEnvironmentOrder": [
     {
      "ComputeEnvironment": {
       "Fn::GetAtt": [
        "LowCostNeuronxCompileComputeEnvironment98C47BC9",
        "ComputeEnvironmentArn"
       ]
      },
      "Order": 1
     }
    ],
    "JobStateTimeLimitActions": [
     {
      "Action": "CANCEL",
      "MaxTimeSeconds": 600,
      "Reason": "MISCONFIGURATION:JOB_RESOURCE_REQUIREMENT",
      "State": "RUNNABLE"
     }
    ],
    "Priority": 1,
    "State": "ENABLED"
   }
  },
  "LowCostNeuronxCompileContainerDefinitionExecutionRoleF1D82BB5": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "LowCostNeuronxCompileContainerDefinitionExecutionRoleDefaultPolicy8495394D": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "logs:CreateLogStream",
        "logs:PutLogEvents"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":logs:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":log-group:/aws/batch/job:*"
         ]
        ]
       }
      },
      {
       "Action": [
        "ecr:BatchCheckLayerAvailability",
        "ecr:BatchGetImage",
        "ecr:GetDownloadUrlForLayer"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":ecr:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":repository/",
          {
           "Fn::Sub": "cdk-hnb659fds-container-assets-${AWS::AccountId}-${AWS::Region}"
          }
         ]
        ]
       }
      },
      {
       "Action": "ecr:GetAuthorizationToken",
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "LowCostNeuronxCompileContainerDefinitionExecutionRoleDefaultPolicy8495394D",
    "Roles": [
     {
      "Ref": "LowCostNeuronxCompileContainerDefinitionExecutionRoleF1D82BB5"
     }
    ]
   }
  },
  "LowCostNeuronxCompileJobDefinitionAE5E9017": {
   "Type": "AWS::Batch::JobDefinition",
   "Properties": {
    "ContainerProperties": {
     "Environment": [
      {
       "Name": "MODEL_ID",
       "Value": "cyberagent/calm3-22b-chat"
      },
      {
       "Name": "TP_DEGREE",
       "Value": "2"
      },
      {
       "Name": "N_POSITIONS",
       "Value": "1024"
      },
      {
       "Name": "OPT_LEVEL",
       "Value": "3"
      },
      {
       "Name": "QUANT_DTYPE",
       "Value": "s8"
      },
      {
       "Name": "ARTIFACT_S3_URL",
       "Value": {
        "Fn::Join": [
         "",
         [
          "s3://",
          {
           "Ref": "Bucket83908E77"
          },
          "/cyberagent/calm3-22b-chat/neuronx-2.19.1/tp2-np1024-opt3-quants8"
         ]
        ]
       }
      }
     ],
     "ExecutionRoleArn": {
      "Fn::GetAtt": [
       "LowCostNeuronxCompileContainerDefinitionExecutionRoleF1D82BB5",
       "Arn"
      ]
     },
     "Image": {
      "Fn::Sub": "${AWS::AccountId}.dkr.ecr.${AWS::Region}.${AWS::URLSuffix}/cdk-hnb659fds-container-assets-${AWS::AccountId}-${AWS::Region}:2ba1a7843b8bcffbb0c4b4cd6f738c9922ab98e7058a5f078f425160293684fd"
     },
     "LinuxParameters": {
      "Devices": [
       {
        "ContainerPath": "/dev/neuron0",
        "HostPath": "/dev/neuron0",
        "Permissions": [
         "read",
         "write"
        ]
       }
      ]
     },
     "ReadonlyRootFilesystem": false,
     "ResourceRequirements": [
      {
       "Type": "MEMORY",
       "Value": "124519"
      },
      {
       "Type": "VCPU",
       "Value": "32"
      }
     ]
    },
    "PlatformCapabilities": [
     "EC2"
    ],
    "RetryStrategy": {},
    "Timeout": {},
    "Type": "container"
   }
  },
  "LowCostNeuronxCompileCompileJobProviderframeworkonEventServiceRoleBB99925A": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "LowCostNeuronxCompileCompileJobProviderframeworkonEventServiceRoleDefaultPolicyA156A755": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "SingletonLambda1361f4695c924c469e115d1dbf925bac39F17F23",
          "Arn"
         ]
        },
        {
         "Fn::GetAtt": [
          "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62246EFD86",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "SingletonLambda1361f4695c924c469e115d1dbf925bac39F17F23",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62246EFD86",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      },
      {
       "Action": "states:StartExecution",
       "Effect": "Allow",
       "Resource": {
        "Ref": "LowCostNeuronxCompileCompileJobProviderwaiterstatemachine7B747BA2"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "LowCostNeuronxCompileCompileJobProviderframeworkonEventServiceRoleDefaultPolicyA156A755",
    "Roles": [
     {
      "Ref": "LowCostNeuronxCompileCompileJobProviderframeworkonEventServiceRoleBB99925A"
     }
    ]
   }
  },
  "LowCostNeuronxCompileCompileJobProviderframeworkonEventDA2E8A5A": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "d9861ea7a45affd23e47a614acb2fddc6e45c20a891284c958187dafbf9ee36b.zip"
    },
    "Description": "AWS CDK resource provider framework - onEvent (IntegCalm3Chat22bSageMakerRealtimeInferenceStack/LowCost/NeuronxCompile/CompileJobProvider)",
    "Environment": {
     "Variables": {
      "USER_ON_EVENT_FUNCTION_ARN": {
       "Fn::GetAtt": [
        "SingletonLambda1361f4695c924c469e115d1dbf925bac39F17F23",
        "Arn"
       ]
      },
      "USER_IS_COMPLETE_FUNCTION_ARN": {
       "Fn::GetAtt": [
        "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62246EFD86",
        "Arn"
       ]
      },
      "WAITER_STATE_MACHINE_ARN": {
       "Ref": "LowCostNeuronxCompileCompileJobProviderwaiterstatemachine7B747BA2"
      }
     }
    },
    "Handler": "framework.onEvent",
    "Role": {
     "Fn::GetAtt": [
      "LowCostNeuronxCompileCompileJobProviderframeworkonEventServiceRoleBB99925A",
      "Arn"
     ]
    },
    "Runtime": {
     "Fn::FindInMap": [
      "LatestNodeRuntimeMap",
      {
       "Ref": "AWS::Region"
      },
      "value"
     ]
    },
    "Timeout": 900
   },
   "DependsOn": [
    "LowCostNeuronxCompileCompileJobProviderframeworkonEventServiceRoleDefaultPolicyA156A755",
    "LowCostNeuronxCompileCompileJobProviderframeworkonEventServiceRoleBB99925A"
   ]
  },
  "LowCostNeuronxCompileCompileJobProviderframeworkisCompleteServiceRoleFBEF59A0": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "LowCostNeuronxCompileCompileJobProviderframeworkisCompleteServiceRoleDefaultPolicy48B57467": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "SingletonLambda1361f4695c924c469e115d1dbf925bac39F17F23",
          "Arn"
         ]
        },
        {
         "Fn::GetAtt": [
          "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62246EFD86",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "SingletonLambda1361f4695c924c469e115d1dbf925bac39F17F23",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62246EFD86",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "LowCostNeuronxCompileCompileJobProviderframeworkisCompleteServiceRoleDefaultPolicy48B57467",
    "Roles": [
     {
      "Ref": "LowCostNeuronxCompileCompileJobProviderframeworkisCompleteServiceRoleFBEF59A0"
     }
    ]
   }
  },
  "LowCostNeuronxCompileCompileJobProviderframeworkisCompleteA50E2628": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "d9861ea7a45affd23e47a614acb2fddc6e45c20a891284c958187dafbf9ee36b.zip"
    },
    "Description": "AWS CDK resource provider framework - isComplete (IntegCalm3Chat22bSageMakerRealtimeInferenceStack/LowCost/NeuronxCompile/CompileJobProvider)",
    "Environment": {
     "Variables": {
      "USER_ON_EVENT_FUNCTION_ARN": {
       "Fn::GetAtt": [
        "SingletonLambda1361f4695c924c469e115d1dbf925bac39F17F23",
        "Arn"
       ]
      },
      "USER_IS_COMPLETE_FUNCTION_ARN": {
       "Fn::GetAtt": [
        "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62246EFD86",
        "Arn"
       ]
      }
     }
    },
    "Handler": "framework.isComplete",
    "Role": {
     "Fn::GetAtt": [
      "LowCostNeuronxCompileCompileJobProviderframeworkisCompleteServiceRoleFBEF59A0",
      "Arn"
     ]
    },
    "Runtime": {
     "Fn::FindInMap": [
      "LatestNodeRuntimeMap",
      {
       "Ref": "AWS::Region"
      },
      "value"
     ]
    },
    "Timeout": 900
   },
   "DependsOn": [
    "LowCostNeuronxCompileCompileJobProviderframeworkisCompleteServiceRoleDefaultPolicy48B57467",
    "LowCostNeuronxCompileCompileJobProviderframeworkisCompleteServiceRoleFBEF59A0"
   ]
  },
  "LowCostNeuronxCompileCompileJobProviderframeworkonTimeoutServiceRole15C30A7A": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "LowCostNeuronxCompileCompileJobProviderframeworkonTimeoutServiceRoleDefaultPolicy59E0B302": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "SingletonLambda1361f4695c924c469e115d1dbf925bac39F17F23",
          "Arn"
         ]
        },
        {
         "Fn::GetAtt": [
          "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62246EFD86",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "SingletonLambda1361f4695c924c469e115d1dbf925bac39F17F23",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62246EFD86",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "LowCostNeuronxCompileCompileJobProviderframeworkonTimeoutServiceRoleDefaultPolicy59E0B302",
    "Roles": [
     {
      "Ref": "LowCostNeuronxCompileCompileJobProviderframeworkonTimeoutServiceRole15C30A7A"
     }
    ]
   }
  },
  "LowCostNeuronxCompileCompileJobProviderframeworkonTimeout96223A73": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "d9861ea7a45affd23e47a614acb2fddc6e45c20a891284c958187dafbf9ee36b.zip"
    },
    "Description": "AWS CDK resource provider framework - onTimeout (IntegCalm3Chat22bSageMakerRealtimeInferenceStack/LowCost/NeuronxCompile/CompileJobProvider)",
    "Environment": {
     "Variables": {
      "USER_ON_EVENT_FUNCTION_ARN": {
       "Fn::GetAtt": [
        "SingletonLambda1361f4695c924c469e115d1dbf925bac39F17F23",
        "Arn"
       ]
      },
      "USER_IS_COMPLETE_FUNCTION_ARN": {
       "Fn::GetAtt": [
        "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62246EFD86",
        "Arn"
       ]
      }
     }
    },
    "Handler": "framework.onTimeout",
    "Role": {
     "Fn::GetAtt": [
      "LowCostNeuronxCompileCompileJobProviderframeworkonTimeoutServiceRole15C30A7A",
      "Arn"
     ]
    },
    "Runtime": {
     "Fn::FindInMap": [
      "LatestNodeRuntimeMap",
      {
       "Ref": "AWS::Region"
      },
      "value"
     ]
    },
    "Timeout": 900
   },
   "DependsOn": [
    "LowCostNeuronxCompileCompileJobProviderframeworkonTimeoutServiceRoleDefaultPolicy59E0B302",
    "LowCostNeuronxCompileCompileJobProviderframeworkonTimeoutServiceRole15C30A7A"
   ]
  },
  "LowCostNeuronxCompileCompileJobProviderwaiterstatemachineRoleB69CBC9E": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "states.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "LowCostNeuronxCompileCompileJobProviderwaiterstatemachineRoleDefaultPolicy3F969A36": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "LowCostNeuronxCompileCompileJobProviderframeworkisCompleteA50E2628",
          "Arn"
         ]
        },
        {
         "Fn::GetAtt": [
          "LowCostNeuronxCompileCompileJobProviderframeworkonTimeout96223A73",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "LowCostNeuronxCompileCompileJobProviderframeworkisCompleteA50E2628",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "LowCostNeuronxCompileCompileJobProviderframeworkonTimeout96223A73",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "logs:CreateLogDelivery",
        "logs:CreateLogStream",
        "logs:DeleteLogDelivery",
        "logs:DescribeLogGroups",
        "logs:DescribeResourcePolicies",
        "logs:GetLogDelivery",
        "logs:ListLogDeliveries",
        "logs:PutLogEvents",
        "logs:PutResourcePolicy",
        "logs:UpdateLogDelivery"
       ],
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "LowCostNeuronxCompileCompileJobProviderwaiterstatemachineRoleDefaultPolicy3F969A36",
    "Roles": [
     {
      "Ref": "LowCostNeuronxCompileCompileJobProviderwaiterstatemachineRoleB69CBC9E"
     }
    ]
   }
  },
  "LowCostNeuronxCompileCompileJobProviderwaiterstatemachineLogGroup6DBC308B": {
   "Type": "AWS::Logs::LogGroup",
   "Properties": {
    "LogGroupName": {
     "Fn::Join": [
      "",
      [
       "/aws/vendedlogs/states/waiter-state-machine-",
       {
        "Ref": "LowCostNeuronxCompileCompileJobProviderframeworkisCompleteA50E2628"
       },
       "-c8c192cd4a3a5260b28bd63a10eb4d90b31dc58d88"
      ]
     ]
    },
    "RetentionInDays": 731
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain"
  },
  "LowCostNeuronxCompileCompileJobProviderwaiterstatemachine7B747BA2": {
   "Type": "AWS::StepFunctions::StateMachine",
   "Properties": {
    "DefinitionString": {
     "Fn::Join": [
      "",
      [
       "{\"StartAt\":\"framework-isComplete-task\",\"States\":{\"framework-isComplete-task\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"States.ALL\"],\"IntervalSeconds\":60,\"MaxAttempts\":60,\"BackoffRate\":1}],\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"Next\":\"framework-onTimeout-task\"}],\"Type\":\"Task\",\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "LowCostNeuronxCompileCompileJobProviderframeworkisCompleteA50E2628",
         "Arn"
        ]
       },
       "\"},\"framework-onTimeout-task\":{\"End\":true,\"Type\":\"Task\",\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "LowCostNeuronxCompileCompileJobProviderframeworkonTimeout96223A73",
         "Arn"
        ]
       },
       "\"}}}"
      ]
     ]
    },
    "LoggingConfiguration": {
     "Destinations": [
      {
       "CloudWatchLogsLogGroup": {
        "LogGroupArn": {
         "Fn::GetAtt": [
          "LowCostNeuronxCompileCompileJobProviderwaiterstatemachineLogGroup6DBC308B",
          "Arn"
         ]
        }
       }
      }
     ],
     "IncludeExecutionData": false,
     "Level": "ERROR"
    },
    "RoleArn": {
     "Fn::GetAtt": [
      "LowCostNeuronxCompileCompileJobProviderwaiterstatemachineRoleB69CBC9E",
      "Arn"
     ]
    }
   },
   "DependsOn": [
    "LowCostNeuronxCompileCompileJobProviderwaiterstatemachineRoleDefaultPolicy3F969A36",
    "LowCostNeuronxCompileCompileJobProviderwaiterstatemachineRoleB69CBC9E"
   ]
  },
  "LowCostNeuronxCompileEAD978A3": {
   "Type": "Custom::NeuronxCompile",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "LowCostNeuronxCompileCompileJobProviderframeworkonEventDA2E8A5A",
      "Arn"
     ]
    },
    "jobDefinitionArn": {
     "Ref": "LowCostNeuronxCompileJobDefinitionAE5E9017"
    },
    "jobQueueArn": {
     "Fn::GetAtt": [
      "LowCostNeuronxCompileJobQueue34F1C1A1",
      "JobQueueArn"
     ]
    },
    "artifactS3Prefix": "cyberagent/calm3-22b-chat/neuronx-2.19.1/tp2-np1024-opt3-quants8"
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "LowCostRealtimeInferenceModelRole6BFAD415": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "sagemaker.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/AmazonSageMakerFullAccess"
       ]
      ]
     }
    ]
   },
   "DependsOn": [
    "LowCostRealtimeInferenceCodeDeploymentAwsCliLayer3BF7416E",
    "LowCostRealtimeInferenceCodeDeploymentCustomResource4AFEC5FB"
   ]
  },
  "LowCostRealtimeInferenceModelRoleDefaultPolicy656E733A": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "ecr:BatchCheckLayerAvailability",
        "ecr:BatchGetImage",
        "ecr:GetDownloadUrlForLayer"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":ecr:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":repository/",
          {
           "Fn::Sub": "cdk-hnb659fds-container-assets-${AWS::AccountId}-${AWS::Region}"
          }
         ]
        ]
       }
      },
      {
       "Action": "ecr:GetAuthorizationToken",
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": [
        "s3:GetBucket*",
        "s3:GetObject*",
        "s3:List*"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "Bucket83908E77",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "Bucket83908E77",
             "Arn"
            ]
           },
           "/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "LowCostRealtimeInferenceModelRoleDefaultPolicy656E733A",
    "Roles": [
     {
      "Ref": "LowCostRealtimeInferenceModelRole6BFAD415"
     }
    ]
   },
   "DependsOn": [
    "LowCostRealtimeInferenceCodeDeploymentAwsCliLayer3BF7416E",
    "LowCostRealtimeInferenceCodeDeploymentCustomResource4AFEC5FB"
   ]
  },
  "LowCostRealtimeInferenceModelB9F36077": {
   "Type": "AWS::SageMaker::Model",
   "Properties": {
    "ExecutionRoleArn": {
     "Fn::GetAtt": [
      "LowCostRealtimeInferenceModelRole6BFAD415",
      "Arn"
     ]
    },
    "PrimaryContainer": {
     "Environment": {
      "NEURON_RT_NUM_CORES": "2",
      "TS_DEFAULT_RESPONSE_TIMEOUT": "3600",
      "TS_DEFAULT_WORKERS_PER_MODEL": "1",
      "MODEL": "./model",
      "COMPILED_ARTIFACT": "./compiled",
      "TP_DEGREE": "2",
      "N_POSITIONS": "1024",
      "OPT_LEVEL": "3",
      "QUANT_DTYPE": "s8"
     },
     "Image": {
      "Fn::Sub": "${AWS::AccountId}.dkr.ecr.${AWS::Region}.${AWS::URLSuffix}/cdk-hnb659fds-container-assets-${AWS::AccountId}-${AWS::Region}:517de47ad0318016bab724073915c0a274a94c894d206d6a9fbdac1186b07221"
     },
     "ModelDataSource": {
      "S3DataSource": {
       "S3Uri": {
        "Fn::Join": [
         "",
         [
          "s3://",
          {
           "Ref": "Bucket83908E77"
          },
          "/cyberagent/calm3-22b-chat/neuronx-2.19.1/tp2-np1024-opt3-quants8/"
         ]
        ]
       },
       "S3DataType": "S3Prefix",
       "CompressionType": "None"
      }
     }
    }
   },
   "DependsOn": [
    "LowCostRealtimeInferenceCodeDeploymentAwsCliLayer3BF7416E",
    "LowCostRealtimeInferenceCodeDeploymentCustomResource4AFEC5FB",
    "LowCostRealtimeInferenceModelRoleDefaultPolicy656E733A",
    "LowCostRealtimeInferenceModelRole6BFAD415"
   ]
  },
  "LowCostRealtimeInferenceCodeDeploymentAwsCliLayer3BF7416E": {
   "Type": "AWS::Lambda::LayerVersion",
   "Properties": {
    "Content": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "3322b7049fb0ed2b7cbb644a2ada8d1116ff80c32dca89e6ada846b5de26f961.zip"
    },
    "Description": "/opt/awscli/aws"
   },
   "DependsOn": [
    "LowCostNeuronxCompileEAD978A3"
   ]
  },
  "LowCostRealtimeInferenceCodeDeploymentCustomResource4AFEC5FB": {
   "Type": "Custom::CDKBucketDeployment",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C81C01536",
      "Arn"
     ]
    },
    "SourceBucketNames": [
     {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     }
    ],
    "SourceObjectKeys": [
     "d6896f4744346384bc550562fde54b5957960e0b064d31e2f8b57478a4332620.zip"
    ],
    "DestinationBucketName": {
     "Ref": "Bucket83908E77"
    },
    "DestinationBucketKeyPrefix": "cyberagent/calm3-22b-chat/neuronx-2.19.1/tp2-np1024-opt3-quants8/code",
    "Prune": true
   },
   "DependsOn": [
    "LowCostNeuronxCompileEAD978A3"
   ],
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "LowCostRealtimeInferenceEndpointConfigD978F716": {
   "Type": "AWS::SageMaker::EndpointConfig",
   "Properties": {
    "ProductionVariants": [
     {
      "ContainerStartupHealthCheckTimeoutInSeconds": 990,
      "InitialInstanceCount": 1,
      "InitialVariantWeight": 1,
      "InstanceType": "ml.trn1.2xlarge",
      "ModelDataDownloadTimeoutInSeconds": 990,
      "ModelName": {
       "Fn::GetAtt": [
        "LowCostRealtimeInferenceModelB9F36077",
        "ModelName"
       ]
      },
      "VariantName": "PrimaryVariant"
     }
    ]
   }
  },
  "LowCostRealtimeInferenceEndpointB633657E": {
   "Type": "AWS::SageMaker::Endpoint",
   "Properties": {
    "EndpointConfigName": {
     "Fn::GetAtt": [
      "LowCostRealtimeInferenceEndpointConfigD978F716",
      "EndpointConfigName"
     ]
    }
   }
  },
  "SingletonLambda08c9850a6f134ed49e2d7888d7b5a258ServiceRole12DC7288": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "SingletonLambda08c9850a6f134ed49e2d7888d7b5a25822148CF9": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "1d1af2ed920aaf02501b235a5491b48957ae8d192ecfc37b4df099fb4c980e8c.zip"
    },
    "Handler": "index.onEvent",
    "Role": {
     "Fn::GetAtt": [
      "SingletonLambda08c9850a6f134ed49e2d7888d7b5a258ServiceRole12DC7288",
      "Arn"
     ]
    },
    "Runtime": "nodejs20.x"
   },
   "DependsOn": [
    "SingletonLambda08c9850a6f134ed49e2d7888d7b5a258ServiceRole12DC7288"
   ]
  },
  "SingletonLambda1361f4695c924c469e115d1dbf925bacServiceRole90E87678": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "SingletonLambda1361f4695c924c469e115d1dbf925bacServiceRoleDefaultPolicy795C8F7D": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "batch:SubmitJob",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "HighPerformanceNeuronxCompileJobQueueFCD7639B",
          "JobQueueArn"
         ]
        },
        {
         "Fn::GetAtt": [
          "LowCostNeuronxCompileJobQueue34F1C1A1",
          "JobQueueArn"
         ]
        },
        {
         "Ref": "HighPerformanceNeuronxCompileJobDefinitionF3E93C9D"
        },
        {
         "Ref": "LowCostNeuronxCompileJobDefinitionAE5E9017"
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "SingletonLambda1361f4695c924c469e115d1dbf925bacServiceRoleDefaultPolicy795C8F7D",
    "Roles": [
     {
      "Ref": "SingletonLambda1361f4695c924c469e115d1dbf925bacServiceRole90E87678"
     }
    ]
   }
  },
  "SingletonLambda1361f4695c924c469e115d1dbf925bac39F17F23": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "42c68ff30e5e72ab503134d5d8b5a42e65aa08ec8a47a811c20610934f3a369a.zip"
    },
    "Handler": "index.onEvent",
    "Role": {
     "Fn::GetAtt": [
      "SingletonLambda1361f4695c924c469e115d1dbf925bacServiceRole90E87678",
      "Arn"
     ]
    },
    "Runtime": "nodejs20.x"
   },
   "DependsOn": [
    "SingletonLambda1361f4695c924c469e115d1dbf925bacServiceRoleDefaultPolicy795C8F7D",
    "SingletonLambda1361f4695c924c469e115d1dbf925bacServiceRole90E87678"
   ]
  },
  "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62ServiceRoleE0466451": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62ServiceRoleDefaultPolicy92D5204A": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "batch:DescribeJobs",
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62ServiceRoleDefaultPolicy92D5204A",
    "Roles": [
     {
      "Ref": "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62ServiceRoleE0466451"
     }
    ]
   }
  },
  "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62246EFD86": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "42c68ff30e5e72ab503134d5d8b5a42e65aa08ec8a47a811c20610934f3a369a.zip"
    },
    "Handler": "index.isComplete",
    "Role": {
     "Fn::GetAtt": [
      "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62ServiceRoleE0466451",
      "Arn"
     ]
    },
    "Runtime": "nodejs20.x"
   },
   "DependsOn": [
    "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62ServiceRoleDefaultPolicy92D5204A",
    "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62ServiceRoleE0466451"
   ]
  },
  "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "s3:GetBucket*",
        "s3:GetObject*",
        "s3:List*"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":s3:::",
           {
            "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
           },
           "/*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":s3:::",
           {
            "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
           }
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "s3:Abort*",
        "s3:DeleteObject*",
        "s3:GetBucket*",
        "s3:GetObject*",
        "s3:List*",
        "s3:PutObject",
        "s3:PutObjectLegalHold",
        "s3:PutObjectRetention",
        "s3:PutObjectTagging",
        "s3:PutObjectVersionTagging"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "Bucket83908E77",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "Bucket83908E77",
             "Arn"
            ]
           },
           "/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF",
    "Roles": [
     {
      "Ref": "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265"
     }
    ]
   }
  },
  "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C81C01536": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "0158f40002a8c211635388a87874fd4dcc3d68f525fe08a0fe0f014069ae539c.zip"
    },
    "Environment": {
     "Variables": {
      "AWS_CA_BUNDLE": "/etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem"
     }
    },
    "Handler": "index.handler",
    "Layers": [
     {
      "Ref": "LowCostRealtimeInferenceCodeDeploymentAwsCliLayer3BF7416E"
     }
    ],
    "Role": {
     "Fn::GetAtt": [
      "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265",
      "Arn"
     ]
    },
    "Runtime": "python3.9",
    "Timeout": 900
   },
   "DependsOn": [
    "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF",
    "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265"
   ]
  },
  "HighPerformanceNeuronxCompileLaunchTemplateC8A774AB": {
   "Type": "AWS::EC2::LaunchTemplate",
   "Properties": {
    "LaunchTemplateData": {
     "BlockDeviceMappings": [
      {
       "DeviceName": "/dev/xvda",
       "Ebs": {
        "VolumeSize": 110
       }
      }
     ],
     "TagSpecifications": [
      {
       "ResourceType": "instance",
       "Tags": [
        {
         "Key": "Name",
         "Value": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/HighPerformance/NeuronxCompile/LaunchTemplate"
        }
       ]
      },
      {
       "ResourceType": "volume",
       "Tags": [
        {
         "Key": "Name",
         "Value": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/HighPerformance/NeuronxCompile/LaunchTemplate"
        }
       ]
      }
     ]
    },
    "TagSpecifications": [
     {
      "ResourceType": "launch-template",
      "Tags": [
       {
        "Key": "Name",
        "Value": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/HighPerformance/NeuronxCompile/LaunchTemplate"
       }
      ]
     }
    ]
   }
  },
  "HighPerformanceNeuronxCompileMachinImageNeuronxAmiProviderframeworkonEventServiceRole9502BCAC": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "HighPerformanceNeuronxCompileMachinImageNeuronxAmiProviderframeworkonEventServiceRoleDefaultPolicyEE176ADA": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "SingletonLambda08c9850a6f134ed49e2d7888d7b5a25822148CF9",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "SingletonLambda08c9850a6f134ed49e2d7888d7b5a25822148CF9",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "HighPerformanceNeuronxCompileMachinImageNeuronxAmiProviderframeworkonEventServiceRoleDefaultPolicyEE176ADA",
    "Roles": [
     {
      "Ref": "HighPerformanceNeuronxCompileMachinImageNeuronxAmiProviderframeworkonEventServiceRole9502BCAC"
     }
    ]
   }
  },
  "HighPerformanceNeuronxCompileMachinImageNeuronxAmiProviderframeworkonEvent326C28C1": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "d9861ea7a45affd23e47a614acb2fddc6e45c20a891284c958187dafbf9ee36b.zip"
    },
    "Description": "AWS CDK resource provider framework - onEvent (IntegCalm3Chat22bSageMakerRealtimeInferenceStack/HighPerformance/NeuronxCompile/MachinImage/NeuronxAmiProvider)",
    "Environment": {
     "Variables": {
      "USER_ON_EVENT_FUNCTION_ARN": {
       "Fn::GetAtt": [
        "SingletonLambda08c9850a6f134ed49e2d7888d7b5a25822148CF9",
        "Arn"
       ]
      }
     }
    },
    "Handler": "framework.onEvent",
    "Role": {
     "Fn::GetAtt": [
      "HighPerformanceNeuronxCompileMachinImageNeuronxAmiProviderframeworkonEventServiceRole9502BCAC",
      "Arn"
     ]
    },
    "Runtime": {
     "Fn::FindInMap": [
      "LatestNodeRuntimeMap",
      {
       "Ref": "AWS::Region"
      },
      "value"
     ]
    },
    "Timeout": 900
   },
   "DependsOn": [
    "HighPerformanceNeuronxCompileMachinImageNeuronxAmiProviderframeworkonEventServiceRoleDefaultPolicyEE176ADA",
    "HighPerformanceNeuronxCompileMachinImageNeuronxAmiProviderframeworkonEventServiceRole9502BCAC"
   ]
  },
  "HighPerformanceNeuronxCompileMachinImageNeuronxAmi70FBA732": {
   "Type": "Custom::NeuronxAmi",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "HighPerformanceNeuronxCompileMachinImageNeuronxAmiProviderframeworkonEvent326C28C1",
      "Arn"
     ]
    },
    "image": {
     "Ref": "HighPerformanceNeuronxCompileMachinImageImageParameterA0C8FEDF"
    }
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "HighPerformanceNeuronxCompileComputeEnvironmentSecurityGroupDBAD4CA7": {
   "Type": "AWS::EC2::SecurityGroup",
   "Properties": {
    "GroupDescription": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack/HighPerformance/NeuronxCompile/ComputeEnvironment/SecurityGroup",
    "SecurityGroupEgress": [
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow all outbound traffic by default",
      "IpProtocol": "-1"
     }
    ],
    "Tags": [
     {
      "Key": "Name",
      "Value": "neuronx-compile-worker"
     }
    ],
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "HighPerformanceNeuronxCompileComputeEnvironmentInstanceProfileRoleA75D5A8B": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ec2.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AmazonEC2ContainerServiceforEC2Role"
       ]
      ]
     }
    ],
    "Tags": [
     {
      "Key": "Name",
      "Value": "neuronx-compile-worker"
     }
    ]
   }
  },
  "HighPerformanceNeuronxCompileComputeEnvironmentInstanceProfileRoleDefaultPolicyF87E8AF3": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "s3:Abort*",
        "s3:DeleteObject*",
        "s3:GetBucket*",
        "s3:GetObject*",
        "s3:List*",
        "s3:PutObject",
        "s3:PutObjectLegalHold",
        "s3:PutObjectRetention",
        "s3:PutObjectTagging",
        "s3:PutObjectVersionTagging"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "Bucket83908E77",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "Bucket83908E77",
             "Arn"
            ]
           },
           "/cyberagent/calm3-22b-chat/neuronx-2.19.1/tp4-np4096-opt3/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "HighPerformanceNeuronxCompileComputeEnvironmentInstanceProfileRoleDefaultPolicyF87E8AF3",
    "Roles": [
     {
      "Ref": "HighPerformanceNeuronxCompileComputeEnvironmentInstanceProfileRoleA75D5A8B"
     }
    ]
   }
  },
  "HighPerformanceNeuronxCompileComputeEnvironmentInstanceProfileE9313FAB": {
   "Type": "AWS::IAM::InstanceProfile",
   "Properties": {
    "Roles": [
     {
      "Ref": "HighPerformanceNeuronxCompileComputeEnvironmentInstanceProfileRoleA75D5A8B"
     }
    ]
   }
  },
  "HighPerformanceNeuronxCompileComputeEnvironmentA9E8DED0": {
   "Type": "AWS::Batch::ComputeEnvironment",
   "Properties": {
    "ComputeResources": {
     "AllocationStrategy": "BEST_FIT_PROGRESSIVE",
     "Ec2Configuration": [
      {
       "ImageIdOverride": {
        "Fn::GetAtt": [
         "HighPerformanceNeuronxCompileMachinImageNeuronxAmi70FBA732",
         "image_id"
        ]
       },
       "ImageType": "ECS_AL2023"
      }
     ],
     "InstanceRole": {
      "Fn::GetAtt": [
       "HighPerformanceNeuronxCompileComputeEnvironmentInstanceProfileE9313FAB",
       "Arn"
      ]
     },
     "InstanceTypes": [
      "inf2.24xlarge"
     ],
     "LaunchTemplate": {
      "LaunchTemplateId": {
       "Ref": "HighPerformanceNeuronxCompileLaunchTemplateC8A774AB"
      },
      "Version": {
       "Fn::GetAtt": [
        "HighPerformanceNeuronxCompileLaunchTemplateC8A774AB",
        "LatestVersionNumber"
       ]
      }
     },
     "MaxvCpus": 256,
     "MinvCpus": 0,
     "SecurityGroupIds": [
      {
       "Fn::GetAtt": [
        "HighPerformanceNeuronxCompileComputeEnvironmentSecurityGroupDBAD4CA7",
        "GroupId"
       ]
      }
     ],
     "Subnets": [
      {
       "Ref": "VpcPrivateSubnet1Subnet536B997A"
      },
      {
       "Ref": "VpcPrivateSubnet2Subnet3788AAA1"
      }
     ],
     "Tags": {
      "Name": "neuronx-compile-worker"
     },
     "Type": "EC2"
    },
    "ReplaceComputeEnvironment": false,
    "State": "ENABLED",
    "Tags": {
     "Name": "neuronx-compile-worker"
    },
    "Type": "managed",
    "UpdatePolicy": {}
   }
  },
  "HighPerformanceNeuronxCompileJobQueueFCD7639B": {
   "Type": "AWS::Batch::JobQueue",
   "Properties": {
    "ComputeEnvironmentOrder": [
     {
      "ComputeEnvironment": {
       "Fn::GetAtt": [
        "HighPerformanceNeuronxCompileComputeEnvironmentA9E8DED0",
        "ComputeEnvironmentArn"
       ]
      },
      "Order": 1
     }
    ],
    "JobStateTimeLimitActions": [
     {
      "Action": "CANCEL",
      "MaxTimeSeconds": 600,
      "Reason": "MISCONFIGURATION:JOB_RESOURCE_REQUIREMENT",
      "State": "RUNNABLE"
     }
    ],
    "Priority": 1,
    "State": "ENABLED"
   }
  },
  "HighPerformanceNeuronxCompileContainerDefinitionExecutionRole1A765384": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "HighPerformanceNeuronxCompileContainerDefinitionExecutionRoleDefaultPolicyD0B7CCD9": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "logs:CreateLogStream",
        "logs:PutLogEvents"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":logs:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":log-group:/aws/batch/job:*"
         ]
        ]
       }
      },
      {
       "Action": [
        "ecr:BatchCheckLayerAvailability",
        "ecr:BatchGetImage",
        "ecr:GetDownloadUrlForLayer"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":ecr:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":repository/",
          {
           "Fn::Sub": "cdk-hnb659fds-container-assets-${AWS::AccountId}-${AWS::Region}"
          }
         ]
        ]
       }
      },
      {
       "Action": "ecr:GetAuthorizationToken",
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "HighPerformanceNeuronxCompileContainerDefinitionExecutionRoleDefaultPolicyD0B7CCD9",
    "Roles": [
     {
      "Ref": "HighPerformanceNeuronxCompileContainerDefinitionExecutionRole1A765384"
     }
    ]
   }
  },
  "HighPerformanceNeuronxCompileJobDefinitionF3E93C9D": {
   "Type": "AWS::Batch::JobDefinition",
   "Properties": {
    "ContainerProperties": {
     "Environment": [
      {
       "Name": "MODEL_ID",
       "Value": "cyberagent/calm3-22b-chat"
      },
      {
       "Name": "TP_DEGREE",
       "Value": "4"
      },
      {
       "Name": "N_POSITIONS",
       "Value": "4096"
      },
      {
       "Name": "OPT_LEVEL",
       "Value": "3"
      },
      {
       "Name": "QUANT_DTYPE",
       "Value": ""
      },
      {
       "Name": "ARTIFACT_S3_URL",
       "Value": {
        "Fn::Join": [
         "",
         [
          "s3://",
          {
           "Ref": "Bucket83908E77"
          },
          "/cyberagent/calm3-22b-chat/neuronx-2.19.1/tp4-np4096-opt3"
         ]
        ]
       }
      }
     ],
     "ExecutionRoleArn": {
      "Fn::GetAtt": [
       "HighPerformanceNeuronxCompileContainerDefinitionExecutionRole1A765384",
       "Arn"
      ]
     },
     "Image": {
      "Fn::Sub": "${AWS::AccountId}.dkr.ecr.${AWS::Region}.${AWS::URLSuffix}/cdk-hnb659fds-container-assets-${AWS::AccountId}-${AWS::Region}:2ba1a7843b8bcffbb0c4b4cd6f738c9922ab98e7058a5f078f425160293684fd"
     },
     "LinuxParameters": {
      "Devices": [
       {
        "ContainerPath": "/dev/neuron0",
        "HostPath": "/dev/neuron0",
        "Permissions": [
         "read",
         "write"
        ]
       },
       {
        "ContainerPath": "/dev/neuron1",
        "HostPath": "/dev/neuron1",
        "Permissions": [
         "read",
         "write"
        ]
       },
       {
        "ContainerPath": "/dev/neuron2",
        "HostPath": "/dev/neuron2",
        "Permissions": [
         "read",
         "write"
        ]
       },
       {
        "ContainerPath": "/dev/neuron3",
        "HostPath": "/dev/neuron3",
        "Permissions": [
         "read",
         "write"
        ]
       },
       {
        "ContainerPath": "/dev/neuron4",
        "HostPath": "/dev/neuron4",
        "Permissions": [
         "read",
         "write"
        ]
       },
       {
        "ContainerPath": "/dev/neuron5",
        "HostPath": "/dev/neuron5",
        "Permissions": [
         "read",
         "write"
        ]
       }
      ]
     },
     "ReadonlyRootFilesystem": false,
     "ResourceRequirements": [
      {
       "Type": "MEMORY",
       "Value": "373556"
      },
      {
       "Type": "VCPU",
       "Value": "96"
      }
     ]
    },
    "PlatformCapabilities": [
     "EC2"
    ],
    "RetryStrategy": {},
    "Timeout": {},
    "Type": "container"
   }
  },
  "HighPerformanceNeuronxCompileCompileJobProviderframeworkonEventServiceRoleA3EE9CD9": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "HighPerformanceNeuronxCompileCompileJobProviderframeworkonEventServiceRoleDefaultPolicyA086F8DF": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "SingletonLambda1361f4695c924c469e115d1dbf925bac39F17F23",
          "Arn"
         ]
        },
        {
         "Fn::GetAtt": [
          "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62246EFD86",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "SingletonLambda1361f4695c924c469e115d1dbf925bac39F17F23",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62246EFD86",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      },
      {
       "Action": "states:StartExecution",
       "Effect": "Allow",
       "Resource": {
        "Ref": "HighPerformanceNeuronxCompileCompileJobProviderwaiterstatemachine5615BD6C"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "HighPerformanceNeuronxCompileCompileJobProviderframeworkonEventServiceRoleDefaultPolicyA086F8DF",
    "Roles": [
     {
      "Ref": "HighPerformanceNeuronxCompileCompileJobProviderframeworkonEventServiceRoleA3EE9CD9"
     }
    ]
   }
  },
  "HighPerformanceNeuronxCompileCompileJobProviderframeworkonEvent60C3DD85": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "d9861ea7a45affd23e47a614acb2fddc6e45c20a891284c958187dafbf9ee36b.zip"
    },
    "Description": "AWS CDK resource provider framework - onEvent (IntegCalm3Chat22bSageMakerRealtimeInferenceStack/HighPerformance/NeuronxCompile/CompileJobProvider)",
    "Environment": {
     "Variables": {
      "USER_ON_EVENT_FUNCTION_ARN": {
       "Fn::GetAtt": [
        "SingletonLambda1361f4695c924c469e115d1dbf925bac39F17F23",
        "Arn"
       ]
      },
      "USER_IS_COMPLETE_FUNCTION_ARN": {
       "Fn::GetAtt": [
        "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62246EFD86",
        "Arn"
       ]
      },
      "WAITER_STATE_MACHINE_ARN": {
       "Ref": "HighPerformanceNeuronxCompileCompileJobProviderwaiterstatemachine5615BD6C"
      }
     }
    },
    "Handler": "framework.onEvent",
    "Role": {
     "Fn::GetAtt": [
      "HighPerformanceNeuronxCompileCompileJobProviderframeworkonEventServiceRoleA3EE9CD9",
      "Arn"
     ]
    },
    "Runtime": {
     "Fn::FindInMap": [
      "LatestNodeRuntimeMap",
      {
       "Ref": "AWS::Region"
      },
      "value"
     ]
    },
    "Timeout": 900
   },
   "DependsOn": [
    "HighPerformanceNeuronxCompileCompileJobProviderframeworkonEventServiceRoleDefaultPolicyA086F8DF",
    "HighPerformanceNeuronxCompileCompileJobProviderframeworkonEventServiceRoleA3EE9CD9"
   ]
  },
  "HighPerformanceNeuronxCompileCompileJobProviderframeworkisCompleteServiceRole61BC74E3": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "HighPerformanceNeuronxCompileCompileJobProviderframeworkisCompleteServiceRoleDefaultPolicy0AA16E45": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "SingletonLambda1361f4695c924c469e115d1dbf925bac39F17F23",
          "Arn"
         ]
        },
        {
         "Fn::GetAtt": [
          "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62246EFD86",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "SingletonLambda1361f4695c924c469e115d1dbf925bac39F17F23",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62246EFD86",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "HighPerformanceNeuronxCompileCompileJobProviderframeworkisCompleteServiceRoleDefaultPolicy0AA16E45",
    "Roles": [
     {
      "Ref": "HighPerformanceNeuronxCompileCompileJobProviderframeworkisCompleteServiceRole61BC74E3"
     }
    ]
   }
  },
  "HighPerformanceNeuronxCompileCompileJobProviderframeworkisComplete1CDC8724": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "d9861ea7a45affd23e47a614acb2fddc6e45c20a891284c958187dafbf9ee36b.zip"
    },
    "Description": "AWS CDK resource provider framework - isComplete (IntegCalm3Chat22bSageMakerRealtimeInferenceStack/HighPerformance/NeuronxCompile/CompileJobProvider)",
    "Environment": {
     "Variables": {
      "USER_ON_EVENT_FUNCTION_ARN": {
       "Fn::GetAtt": [
        "SingletonLambda1361f4695c924c469e115d1dbf925bac39F17F23",
        "Arn"
       ]
      },
      "USER_IS_COMPLETE_FUNCTION_ARN": {
       "Fn::GetAtt": [
        "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62246EFD86",
        "Arn"
       ]
      }
     }
    },
    "Handler": "framework.isComplete",
    "Role": {
     "Fn::GetAtt": [
      "HighPerformanceNeuronxCompileCompileJobProviderframeworkisCompleteServiceRole61BC74E3",
      "Arn"
     ]
    },
    "Runtime": {
     "Fn::FindInMap": [
      "LatestNodeRuntimeMap",
      {
       "Ref": "AWS::Region"
      },
      "value"
     ]
    },
    "Timeout": 900
   },
   "DependsOn": [
    "HighPerformanceNeuronxCompileCompileJobProviderframeworkisCompleteServiceRoleDefaultPolicy0AA16E45",
    "HighPerformanceNeuronxCompileCompileJobProviderframeworkisCompleteServiceRole61BC74E3"
   ]
  },
  "HighPerformanceNeuronxCompileCompileJobProviderframeworkonTimeoutServiceRole28B07136": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "HighPerformanceNeuronxCompileCompileJobProviderframeworkonTimeoutServiceRoleDefaultPolicy2F6CD114": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "SingletonLambda1361f4695c924c469e115d1dbf925bac39F17F23",
          "Arn"
         ]
        },
        {
         "Fn::GetAtt": [
          "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62246EFD86",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "SingletonLambda1361f4695c924c469e115d1dbf925bac39F17F23",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62246EFD86",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "HighPerformanceNeuronxCompileCompileJobProviderframeworkonTimeoutServiceRoleDefaultPolicy2F6CD114",
    "Roles": [
     {
      "Ref": "HighPerformanceNeuronxCompileCompileJobProviderframeworkonTimeoutServiceRole28B07136"
     }
    ]
   }
  },
  "HighPerformanceNeuronxCompileCompileJobProviderframeworkonTimeoutF592D403": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "d9861ea7a45affd23e47a614acb2fddc6e45c20a891284c958187dafbf9ee36b.zip"
    },
    "Description": "AWS CDK resource provider framework - onTimeout (IntegCalm3Chat22bSageMakerRealtimeInferenceStack/HighPerformance/NeuronxCompile/CompileJobProvider)",
    "Environment": {
     "Variables": {
      "USER_ON_EVENT_FUNCTION_ARN": {
       "Fn::GetAtt": [
        "SingletonLambda1361f4695c924c469e115d1dbf925bac39F17F23",
        "Arn"
       ]
      },
      "USER_IS_COMPLETE_FUNCTION_ARN": {
       "Fn::GetAtt": [
        "SingletonLambdadf16dba85f77480ca6adcfdf74c3de62246EFD86",
        "Arn"
       ]
      }
     }
    },
    "Handler": "framework.onTimeout",
    "Role": {
     "Fn::GetAtt": [
      "HighPerformanceNeuronxCompileCompileJobProviderframeworkonTimeoutServiceRole28B07136",
      "Arn"
     ]
    },
    "Runtime": {
     "Fn::FindInMap": [
      "LatestNodeRuntimeMap",
      {
       "Ref": "AWS::Region"
      },
      "value"
     ]
    },
    "Timeout": 900
   },
   "DependsOn": [
    "HighPerformanceNeuronxCompileCompileJobProviderframeworkonTimeoutServiceRoleDefaultPolicy2F6CD114",
    "HighPerformanceNeuronxCompileCompileJobProviderframeworkonTimeoutServiceRole28B07136"
   ]
  },
  "HighPerformanceNeuronxCompileCompileJobProviderwaiterstatemachineRole980BD9C4": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "states.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "HighPerformanceNeuronxCompileCompileJobProviderwaiterstatemachineRoleDefaultPolicyE43D8D3C": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "HighPerformanceNeuronxCompileCompileJobProviderframeworkisComplete1CDC8724",
          "Arn"
         ]
        },
        {
         "Fn::GetAtt": [
          "HighPerformanceNeuronxCompileCompileJobProviderframeworkonTimeoutF592D403",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "HighPerformanceNeuronxCompileCompileJobProviderframeworkisComplete1CDC8724",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "HighPerformanceNeuronxCompileCompileJobProviderframeworkonTimeoutF592D403",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "logs:CreateLogDelivery",
        "logs:CreateLogStream",
        "logs:DeleteLogDelivery",
        "logs:DescribeLogGroups",
        "logs:DescribeResourcePolicies",
        "logs:GetLogDelivery",
        "logs:ListLogDeliveries",
        "logs:PutLogEvents",
        "logs:PutResourcePolicy",
        "logs:UpdateLogDelivery"
       ],
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "HighPerformanceNeuronxCompileCompileJobProviderwaiterstatemachineRoleDefaultPolicyE43D8D3C",
    "Roles": [
     {
      "Ref": "HighPerformanceNeuronxCompileCompileJobProviderwaiterstatemachineRole980BD9C4"
     }
    ]
   }
  },
  "HighPerformanceNeuronxCompileCompileJobProviderwaiterstatemachineLogGroupBEC6CFFA": {
   "Type": "AWS::Logs::LogGroup",
   "Properties": {
    "LogGroupName": {
     "Fn::Join": [
      "",
      [
       "/aws/vendedlogs/states/waiter-state-machine-",
       {
        "Ref": "HighPerformanceNeuronxCompileCompileJobProviderframeworkisComplete1CDC8724"
       },
       "-c8a861fe323e5317b931c7ca21cf9d8b6f0af5c69a"
      ]
     ]
    },
    "RetentionInDays": 731
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain"
  },
  "HighPerformanceNeuronxCompileCompileJobProviderwaiterstatemachine5615BD6C": {
   "Type": "AWS::StepFunctions::StateMachine",
   "Properties": {
    "DefinitionString": {
     "Fn::Join": [
      "",
      [
       "{\"StartAt\":\"framework-isComplete-task\",\"States\":{\"framework-isComplete-task\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"States.ALL\"],\"IntervalSeconds\":60,\"MaxAttempts\":60,\"BackoffRate\":1}],\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"Next\":\"framework-onTimeout-task\"}],\"Type\":\"Task\",\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "HighPerformanceNeuronxCompileCompileJobProviderframeworkisComplete1CDC8724",
         "Arn"
        ]
       },
       "\"},\"framework-onTimeout-task\":{\"End\":true,\"Type\":\"Task\",\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "HighPerformanceNeuronxCompileCompileJobProviderframeworkonTimeoutF592D403",
         "Arn"
        ]
       },
       "\"}}}"
      ]
     ]
    },
    "LoggingConfiguration": {
     "Destinations": [
      {
       "CloudWatchLogsLogGroup": {
        "LogGroupArn": {
         "Fn::GetAtt": [
          "HighPerformanceNeuronxCompileCompileJobProviderwaiterstatemachineLogGroupBEC6CFFA",
          "Arn"
         ]
        }
       }
      }
     ],
     "IncludeExecutionData": false,
     "Level": "ERROR"
    },
    "RoleArn": {
     "Fn::GetAtt": [
      "HighPerformanceNeuronxCompileCompileJobProviderwaiterstatemachineRole980BD9C4",
      "Arn"
     ]
    }
   },
   "DependsOn": [
    "HighPerformanceNeuronxCompileCompileJobProviderwaiterstatemachineRoleDefaultPolicyE43D8D3C",
    "HighPerformanceNeuronxCompileCompileJobProviderwaiterstatemachineRole980BD9C4"
   ]
  },
  "HighPerformanceNeuronxCompileBA954C77": {
   "Type": "Custom::NeuronxCompile",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "HighPerformanceNeuronxCompileCompileJobProviderframeworkonEvent60C3DD85",
      "Arn"
     ]
    },
    "jobDefinitionArn": {
     "Ref": "HighPerformanceNeuronxCompileJobDefinitionF3E93C9D"
    },
    "jobQueueArn": {
     "Fn::GetAtt": [
      "HighPerformanceNeuronxCompileJobQueueFCD7639B",
      "JobQueueArn"
     ]
    },
    "artifactS3Prefix": "cyberagent/calm3-22b-chat/neuronx-2.19.1/tp4-np4096-opt3"
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "HighPerformanceRealtimeInferenceModelRole0289ECF8": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "sagemaker.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/AmazonSageMakerFullAccess"
       ]
      ]
     }
    ]
   },
   "DependsOn": [
    "HighPerformanceRealtimeInferenceCodeDeploymentAwsCliLayer982D5CC9",
    "HighPerformanceRealtimeInferenceCodeDeploymentCustomResource1C65D8BA"
   ]
  },
  "HighPerformanceRealtimeInferenceModelRoleDefaultPolicy877786AF": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "ecr:BatchCheckLayerAvailability",
        "ecr:BatchGetImage",
        "ecr:GetDownloadUrlForLayer"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":ecr:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":repository/",
          {
           "Fn::Sub": "cdk-hnb659fds-container-assets-${AWS::AccountId}-${AWS::Region}"
          }
         ]
        ]
       }
      },
      {
       "Action": "ecr:GetAuthorizationToken",
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": [
        "s3:GetBucket*",
        "s3:GetObject*",
        "s3:List*"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "Bucket83908E77",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "Bucket83908E77",
             "Arn"
            ]
           },
           "/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "HighPerformanceRealtimeInferenceModelRoleDefaultPolicy877786AF",
    "Roles": [
     {
      "Ref": "HighPerformanceRealtimeInferenceModelRole0289ECF8"
     }
    ]
   },
   "DependsOn": [
    "HighPerformanceRealtimeInferenceCodeDeploymentAwsCliLayer982D5CC9",
    "HighPerformanceRealtimeInferenceCodeDeploymentCustomResource1C65D8BA"
   ]
  },
  "HighPerformanceRealtimeInferenceModel039D31D5": {
   "Type": "AWS::SageMaker::Model",
   "Properties": {
    "ExecutionRoleArn": {
     "Fn::GetAtt": [
      "HighPerformanceRealtimeInferenceModelRole0289ECF8",
      "Arn"
     ]
    },
    "PrimaryContainer": {
     "Environment": {
      "NEURON_RT_NUM_CORES": "4",
      "TS_DEFAULT_RESPONSE_TIMEOUT": "3600",
      "TS_DEFAULT_WORKERS_PER_MODEL": "3",
      "MODEL": "./model",
      "COMPILED_ARTIFACT": "./compiled",
      "TP_DEGREE": "4",
      "N_POSITIONS": "4096",
      "OPT_LEVEL": "3",
      "QUANT_DTYPE": ""
     },
     "Image": {
      "Fn::Sub": "${AWS::AccountId}.dkr.ecr.${AWS::Region}.${AWS::URLSuffix}/cdk-hnb659fds-container-assets-${AWS::AccountId}-${AWS::Region}:517de47ad0318016bab724073915c0a274a94c894d206d6a9fbdac1186b07221"
     },
     "ModelDataSource": {
      "S3DataSource": {
       "S3Uri": {
        "Fn::Join": [
         "",
         [
          "s3://",
          {
           "Ref": "Bucket83908E77"
          },
          "/cyberagent/calm3-22b-chat/neuronx-2.19.1/tp4-np4096-opt3/"
         ]
        ]
       },
       "S3DataType": "S3Prefix",
       "CompressionType": "None"
      }
     }
    }
   },
   "DependsOn": [
    "HighPerformanceRealtimeInferenceCodeDeploymentAwsCliLayer982D5CC9",
    "HighPerformanceRealtimeInferenceCodeDeploymentCustomResource1C65D8BA",
    "HighPerformanceRealtimeInferenceModelRoleDefaultPolicy877786AF",
    "HighPerformanceRealtimeInferenceModelRole0289ECF8"
   ]
  },
  "HighPerformanceRealtimeInferenceCodeDeploymentAwsCliLayer982D5CC9": {
   "Type": "AWS::Lambda::LayerVersion",
   "Properties": {
    "Content": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "3322b7049fb0ed2b7cbb644a2ada8d1116ff80c32dca89e6ada846b5de26f961.zip"
    },
    "Description": "/opt/awscli/aws"
   },
   "DependsOn": [
    "HighPerformanceNeuronxCompileBA954C77"
   ]
  },
  "HighPerformanceRealtimeInferenceCodeDeploymentCustomResource1C65D8BA": {
   "Type": "Custom::CDKBucketDeployment",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C81C01536",
      "Arn"
     ]
    },
    "SourceBucketNames": [
     {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     }
    ],
    "SourceObjectKeys": [
     "d6896f4744346384bc550562fde54b5957960e0b064d31e2f8b57478a4332620.zip"
    ],
    "DestinationBucketName": {
     "Ref": "Bucket83908E77"
    },
    "DestinationBucketKeyPrefix": "cyberagent/calm3-22b-chat/neuronx-2.19.1/tp4-np4096-opt3/code",
    "Prune": true
   },
   "DependsOn": [
    "HighPerformanceNeuronxCompileBA954C77"
   ],
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "HighPerformanceRealtimeInferenceEndpointConfig939F817F": {
   "Type": "AWS::SageMaker::EndpointConfig",
   "Properties": {
    "ProductionVariants": [
     {
      "ContainerStartupHealthCheckTimeoutInSeconds": 990,
      "InitialInstanceCount": 1,
      "InitialVariantWeight": 1,
      "InstanceType": "ml.inf2.24xlarge",
      "ModelDataDownloadTimeoutInSeconds": 990,
      "ModelName": {
       "Fn::GetAtt": [
        "HighPerformanceRealtimeInferenceModel039D31D5",
        "ModelName"
       ]
      },
      "VariantName": "PrimaryVariant",
      "VolumeSizeInGB": 66
     }
    ]
   }
  },
  "HighPerformanceRealtimeInferenceEndpointA439BE64": {
   "Type": "AWS::SageMaker::Endpoint",
   "Properties": {
    "EndpointConfigName": {
     "Fn::GetAtt": [
      "HighPerformanceRealtimeInferenceEndpointConfig939F817F",
      "EndpointConfigName"
     ]
    }
   }
  }
 },
 "Mappings": {
  "LatestNodeRuntimeMap": {
   "af-south-1": {
    "value": "nodejs20.x"
   },
   "ap-east-1": {
    "value": "nodejs20.x"
   },
   "ap-northeast-1": {
    "value": "nodejs20.x"
   },
   "ap-northeast-2": {
    "value": "nodejs20.x"
   },
   "ap-northeast-3": {
    "value": "nodejs20.x"
   },
   "ap-south-1": {
    "value": "nodejs20.x"
   },
   "ap-south-2": {
    "value": "nodejs20.x"
   },
   "ap-southeast-1": {
    "value": "nodejs20.x"
   },
   "ap-southeast-2": {
    "value": "nodejs20.x"
   },
   "ap-southeast-3": {
    "value": "nodejs20.x"
   },
   "ap-southeast-4": {
    "value": "nodejs20.x"
   },
   "ap-southeast-5": {
    "value": "nodejs20.x"
   },
   "ap-southeast-7": {
    "value": "nodejs20.x"
   },
   "ca-central-1": {
    "value": "nodejs20.x"
   },
   "ca-west-1": {
    "value": "nodejs20.x"
   },
   "cn-north-1": {
    "value": "nodejs18.x"
   },
   "cn-northwest-1": {
    "value": "nodejs18.x"
   },
   "eu-central-1": {
    "value": "nodejs20.x"
   },
   "eu-central-2": {
    "value": "nodejs20.x"
   },
   "eu-isoe-west-1": {
    "value": "nodejs18.x"
   },
   "eu-north-1": {
    "value": "nodejs20.x"
   },
   "eu-south-1": {
    "value": "nodejs20.x"
   },
   "eu-south-2": {
    "value": "nodejs20.x"
   },
   "eu-west-1": {
    "value": "nodejs20.x"
   },
   "eu-west-2": {
    "value": "nodejs20.x"
   },
   "eu-west-3": {
    "value": "nodejs20.x"
   },
   "il-central-1": {
    "value": "nodejs20.x"
   },
   "me-central-1": {
    "value": "nodejs20.x"
   },
   "me-south-1": {
    "value": "nodejs20.x"
   },
   "mx-central-1": {
    "value": "nodejs20.x"
   },
   "sa-east-1": {
    "value": "nodejs20.x"
   },
   "us-east-1": {
    "value": "nodejs20.x"
   },
   "us-east-2": {
    "value": "nodejs20.x"
   },
   "us-gov-east-1": {
    "value": "nodejs18.x"
   },
   "us-gov-west-1": {
    "value": "nodejs18.x"
   },
   "us-iso-east-1": {
    "value": "nodejs18.x"
   },
   "us-iso-west-1": {
    "value": "nodejs18.x"
   },
   "us-isob-east-1": {
    "value": "nodejs18.x"
   },
   "us-west-1": {
    "value": "nodejs20.x"
   },
   "us-west-2": {
    "value": "nodejs20.x"
   }
  }
 },
 "Parameters": {
  "LowCostNeuronxCompileMachinImageImageParameter337DF9DB": {
   "Type": "AWS::SSM::Parameter::Value<String>",
   "Default": "/aws/service/ecs/optimized-ami/amazon-linux-2023/neuron/recommended"
  },
  "HighPerformanceNeuronxCompileMachinImageImageParameterA0C8FEDF": {
   "Type": "AWS::SSM::Parameter::Value<String>",
   "Default": "/aws/service/ecs/optimized-ami/amazon-linux-2023/neuron/recommended"
  },
  "BootstrapVersion": {
   "Type": "AWS::SSM::Parameter::Value<String>",
   "Default": "/cdk-bootstrap/hnb659fds/version",
   "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
  }
 },
 "Outputs": {
  "ExportsOutputFnGetAttLowCostRealtimeInferenceEndpointB633657EEndpointNameF69CA255": {
   "Value": {
    "Fn::GetAtt": [
     "LowCostRealtimeInferenceEndpointB633657E",
     "EndpointName"
    ]
   },
   "Export": {
    "Name": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack:ExportsOutputFnGetAttLowCostRealtimeInferenceEndpointB633657EEndpointNameF69CA255"
   }
  },
  "ExportsOutputFnGetAttHighPerformanceRealtimeInferenceEndpointA439BE64EndpointNameA774AA1E": {
   "Value": {
    "Fn::GetAtt": [
     "HighPerformanceRealtimeInferenceEndpointA439BE64",
     "EndpointName"
    ]
   },
   "Export": {
    "Name": "IntegCalm3Chat22bSageMakerRealtimeInferenceStack:ExportsOutputFnGetAttHighPerformanceRealtimeInferenceEndpointA439BE64EndpointNameA774AA1E"
   }
  }
 },
 "Rules": {
  "CheckBootstrapVersion": {
   "Assertions": [
    {
     "Assert": {
      "Fn::Not": [
       {
        "Fn::Contains": [
         [
          "1",
          "2",
          "3",
          "4",
          "5"
         ],
         {
          "Ref": "BootstrapVersion"
         }
        ]
       }
      ]
     },
     "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
    }
   ]
  }
 }
}